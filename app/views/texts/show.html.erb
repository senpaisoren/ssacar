<div class="total" style="margin-left:7.5%">
<div class="centered">
	<h1><%= @text.title %></a><br>
	<small>Submitted by <%= @text.user.name %> <%= time_ago_in_words(@text.created_at) %> ago. </small>
</h1>
</div>
 <% profanity_filter = LanguageFilter::Filter.new matchlist: :profanity, creative_letters: true %>
 <% sex_filter = LanguageFilter::Filter.new matchlist: :sex, creative_letters: true %>
 <% hate_filter = LanguageFilter::Filter.new matchlist: :hate, creative_letters: true %>
 
<% if profanity_filter.match?(@text.content) or sex_filter.match?(@text.content) or hate_filter.match?(@text.content) %>
    <% @text.update_attribute(:reported, true) %>
<% end %>

<% if @text.resolved == true %>
<h4> [This post has been marked as addressed or resolved by a staff member] </h4>
<% end %>

<% if @text.reported == true %>
<h4> [This post has been reported by a member of the community or auto-flagged for inappropriate content] </h4>
<% end %>

<% if @text.reported == false %>
<h4> [This post was previously reported or auto-flagged, but has been marked safe by a staff member] </h4>
<% end %>

<% if @text.reported != true or (@text.reported == true and current_user.present? and current_user.rank == 1) %>
<div class="postcontent">
	<h4><%= @text.content %>
	</h4>
</div>
<% if (current_user.present?) %>
	<% if ((@text.user == current_user) and ((Time.now.to_i - @text.created_at.to_i) < 7200) and (@text.reported == nil)) or (current_user.rank == 1) %>
		<div class="btn-group">
	  		<%= link_to 'Edit', edit_text_path(@text), class: "btn btn-default" %>
	 	</div>
	<% end %>

	<% if (@text.user == current_user) or (current_user.rank == 1) %>
		 <div class="btn-group">
		  <%= link_to 'Delete', @text, method: :delete, data: { confirm: 'Are you sure?' }, class: "btn btn-default" %>
		 </div>
	<% end %>
<% end %>

<% if current_user.present? %>
	<% if (@text.resolved == nil) && (current_user.rank == 1) %>
		<div class="btn-group">
			<%= link_to resolve_text_path(@text), method: :put, class: "btn btn-default" do %>
				<span class="glyphicon glyphicon-check"></span>
				Resolve
			<% end %>
		</div>
	<% end %>

	<% if (@text.reported == nil) %>
		<div class="btn-group">
			<%= link_to report_text_path(@text), method: :put, class: "btn btn-default" do %>
				<span class="glyphicon glyphicon-flag"></span>
				Report
			<% end %>
		</div>
	<% end %>

	<% if (@text.reported == true) && (current_user.rank == 1) %>
		<div class="btn-group">
			<%= link_to unreport_text_path(@text), method: :put, class: "btn btn-default" do %>
				<span class="glyphicon glyphicon-ok-circle"></span>
				Mark as Safe
			<% end %>
		</div>
	<% end %>
	
	<% if (@text.voted_on_by? current_user) %>
		<%= link_to unlike_text_path(@text), method: :put, class: "btn btn-default btn-sm" do %>
			<span class="glyphicon glyphicon-minus"></span>
		    Remove Vote
		<% end %>
		<%= link_to like_text_path(@text), method: :put, class: "btn btn-default btn-sm" do %>
			<span class="glyphicon glyphicon-chevron-up"></span>
		    Upvote (
		    <%= @text.get_upvotes.size %>
		    )
		<% end %>
		<%= link_to dislike_text_path(@text), method: :put, class: "btn btn-default btn-sm" do %>
			<span class="glyphicon glyphicon-chevron-down"></span>
		    Downvote (
		    <%= @text.get_downvotes.size %>
		    )
		<% end %>
	<% end %>

	<% if !(@text.voted_on_by? current_user) %>   
		<%= link_to like_text_path(@text), method: :put, class: "btn btn-default btn-sm" do %>
	      <span class="glyphicon glyphicon-chevron-up"></span>
	      Upvote (
	      <%= @text.get_upvotes.size %>
	      )
	    <% end %>
	    <%= link_to dislike_text_path(@text), method: :put, class: "btn btn-default btn-sm" do %>
	      <span class="glyphicon glyphicon-chevron-down"></span>
	      Downvote (
	      <%= @text.get_downvotes.size %>
	      )
	    <% end %>
	<% end %>
<% end %>
</div>
<% end %>
</div>
